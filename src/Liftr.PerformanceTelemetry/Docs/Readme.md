This project contains the components needed for the Liftr PerformanceTelemetry.
There are three main parts of this project:

# Project design
Performance Dashboard design solution - https://microsoftapc-my.sharepoint.com/:w:/g/personal/saurgupta_microsoft_com/EQG3GkwEATBGmwLIv3DGTCcB-qCfOhOyd9_pgR3vKlo2nA?e=SY3D7C

This is part of the Liftr Common dashboard initiative where the aim is to track system's reliability, performance and infra health as a whole. Please learn more about it here - https://microsoft.sharepoint.com/:p:/t/Liftr-Elastic2/EWzN8g4zjUtIqwq8YVXOwDIBV2PfIeCHud5wI1_eDx_mBA?e=khZmC1

## How to onboard
Reference PR - https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz/pullrequest/5550401
1. For every API call(RPaaS to RP), call this package's OperationDetails method with operationTypes and Statuses parameters being selected as Start and None respectively. Please find it here [Calling OperationDetails method when the sync operation starts](https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz?path=/src/Liftr.Logz.RP.Web/Controllers/MonitorsResourceController.cs&version=GBmain&line=129&lineEnd=137&lineStartColumn=17&lineEndColumn=26&lineStyle=plain&_a=contents). This is to start monitoring the sync operation of this API call.
2. When the sync operation ends, introduce the same method call but with operationTypes and Statuses parameters being selected as Stop and Success(if the API is returning success) respectively. Please find it here [Calling OperationDetails method when the sync operation stops](https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz?path=/src/Liftr.Logz.RP.Web/Controllers/MonitorsResourceController.cs&version=GBmain&line=161&lineEnd=169&lineStartColumn=21&lineEndColumn=34&lineStyle=plain&_a=contents).
3. Note - The subOperation parameter during the above 2 calls with be null.
4. During the flow of an API, whenever there's an async operation be it making DB calls, call to marketplace APIs, calls to partners(external) or any other dependent services, track those calls by calling the operationDetails method by passing a relevant subOperation name.
5. Call the operationDetails method during the start of the sub operation like this [Calling OperationDetails method when an async operation starts](https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz?path=/src/Liftr.Logz.Service/IdempotentService.cs&version=GBmain&line=82&lineEnd=90&lineStartColumn=25&lineEndColumn=34&lineStyle=plain&_a=contents).
6. Call the operationDetails method during the stop of the sub operation like this [Calling OperationDetails method when an async operation stops](https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz?path=/src/Liftr.Logz.Service/IdempotentService.cs&version=GBmain&line=97&lineEnd=105&lineStartColumn=25&lineEndColumn=34&lineStyle=plain&_a=contents).
7. You can chose not to track the end of an API call or a sub operation if the call didn't return success as we are not capturing the performance of failed API calls.
8. Please use the abstract class [MainOperationNameBaseType](https://msazure.visualstudio.com/Liftr/_git/Liftr.Common?path=/src/Liftr.PerformanceTelemetry/Models/Operations/MainOperationNameBaseType.cs) to extend and create mainOperations class that is more relevant to the RP. please find the one that logz created here [MainOperations](https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz?path=/src/Liftr.Logz.Service.Abstractions/Models/TelemetryCapture/Operations/MainOperations.cs&_a=contents&version=GBmain). This will bind the mainOperations to the MainOperationNameBaseType class that we are supposed to pass as a parameter to the method OperationDetails of this package.
9. Please use the abstract class [SubOperationNameBaseType](https://msazure.visualstudio.com/Liftr/_git/Liftr.Common?path=/src/Liftr.PerformanceTelemetry/Models/Operations/SubOperationNameBaseType.cs) to extend and create subOperations class that is more relevant to the RP. please find the one that logz created here [CreateMainAccountSubOperations](https://msazure.visualstudio.com/Liftr/_git/Liftr.Logz?path=/src/Liftr.Logz.Service.Abstractions/Models/TelemetryCapture/Operations/SubOperations/CreateMainAccountSubOperations.cs&_a=contents&version=GBmain). This will bind the subOperations to the SubOperationNameBaseType class that we are supposed to pass as a parameter to the method OperationDetails of this package.
10. Please leverage and use the classes [MainCommonOperations](https://msazure.visualstudio.com/Liftr/_git/Liftr.Common?path=/src/Liftr.PerformanceTelemetry/Models/Operations/MainCommonOperations.cs) and [SubCommonOperations](https://msazure.visualstudio.com/Liftr/_git/Liftr.Common?path=/src/Liftr.PerformanceTelemetry/Models/Operations/SubCommonOperations.cs) for all the common main operations and common suboperations. This is handy when we have the operations on the marketplace service. Please feel free to extend it and add more operations to it as required.

## Tips on using the dashboard
1. Please find the [Liftr performance dashboard here](https://dataexplorer.azure.com/dashboards/95f2c1a8-9f33-47fd-8c20-fb10e3aa1322).
2. The dropdown options - 
    - Time range - will be applied to all the tiles and represents exactly what it says i.e showing the performance of the APIs for the time range selected.
    - Partners - will also be applied to all the tiles represents exactly what it says i.e showing the performance of the APIs for the selected liftr partners for the time range selected.
    - Environment - will also be applied to all the tiles represents exactly what is says i.e showing the performance of the APIs for that environment for the selected liftr partners for the time range selected. We have regions eastus and eastus2 under canary environment and any other region goes inside the Production environment.
    - Region - This selection overrides the Environment selection. This also applies to all the tiles and can be leveraged to have more control over the results. One can add the region(eg - westus2) into this field and the results will be shown accordingly.
    - Percentile - will be applied to all the tiles except the tabular tiles named - *Details of Sync operations* and *Details of Async operations* respectively. Please use this dropdown to toggle between P50, P75, P90, P95 and P99 options respectively and the results in the tiles will change accordingly.
    - Sync OperationName - this is a single selection dynamic dropdown field that gets updated based on the 4 parameters selected - *Region, Environment, Time range and Partners*.
    - Async OperationName - this is a single selection dynamic dropdown field that gets updated based on the 5 parameters selected - *Region, Environment, Time range, Partners and Sync OperationName*.
    - UniqueidentifierId - The user can track the detailed latencies of an uniqueIdentierId by passing it in this textual field. This field will updated the tiles with names - *Details of Sync operations* and *Details of Async operations* respectively.
    - CorrelationId - The user can track the detailed latencies wrt a correlationId by passing it in this textual field. This field will updated the tiles with names - *Details of Sync operations* and *Details of Async operations* respectively.

## Troubleshooting
1. Please make sure that you provide same uniqueIdentifierType and uniqueIdentifierid for the same start and stop operations. Not doing this will fetch and show wrong latency values on the dashboard.