//-----------------------------------------------------------------------------
// Copyright (c) Microsoft Corporation.  All rights reserved.
//-----------------------------------------------------------------------------

using Newtonsoft.Json;
using Xunit;

namespace Microsoft.Liftr.Utilities.Tests
{
    public class InstanceMetadataTests
    {
        [Fact]
        public void Parse()
        {
            var input = "eyJjb21wdXRlIjp7ImF6RW52aXJvbm1lbnQiOiJBenVyZVB1YmxpY0Nsb3VkIiwiY3VzdG9tRGF0YSI6IiIsImxvY2F0aW9uIjoic291dGhjZW50cmFsdXMiLCJuYW1lIjoiYWtzLWdyYWRldnNjdXMtMTQzODg3OTMtdm1zc18yIiwib2ZmZXIiOiIiLCJvc1R5cGUiOiJMaW51eCIsInBsYWNlbWVudEdyb3VwSWQiOiI4YTU2YmZmNi0yYTRiLTQ0MWQtOGE1My0wMzQxM2VmNmI0OGEiLCJwbGFuIjp7Im5hbWUiOiIiLCJwcm9kdWN0IjoiIiwicHVibGlzaGVyIjoiIn0sInBsYXRmb3JtRmF1bHREb21haW4iOiIwIiwicGxhdGZvcm1VcGRhdGVEb21haW4iOiIwIiwicHJvdmlkZXIiOiJNaWNyb3NvZnQuQ29tcHV0ZSIsInB1YmxpY0tleXMiOlt7ImtleURhdGEiOiJzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUNBUURJNnFQeDQ1UGVUMHA2Q0dDTEtxbUsybXM3RVhqWDhzTGMyWnkraEdRMWtzWlI1K3JjMlRoZW0vcmdRZjhxTHZ6NmxLL002Vy9hUUlLb09nampHUU1kRHFpVWpYU3REc2JLOWFPVUk5OXM0eDhkOE1ySEovZFRzb3k0b3VOK09RbVVwQjd6cUJuejhVZXRON0JIeXFMMEZja1pRWEJQWjFBM2ZkMExzSmRKd2hKaGZFeUhKNUVIS1RyaUYrL21YZFFLbTYzWnhaajBqb1RudlpPQm9zeU9pWXg2a0MvaVhGd0NXeXpqR0QyQ2FGakgxNDdic2tKWmhwOGNkV2d5ZW1oSDlCU25IdysyVFZHeEZOazlZNTBKa0Nrc29xbU1pcFgxNDVNdHBMYnRybWpLTGxPdENSY3p0dFVxRkFvNWhMQ210RFN4ZEdDOThKWHhKRHIyZFd6TzJRRUozWDU0WEE3Q2NaT2I3ZGdHdDFlcVF6NDZqOVQ1SGxkQ2ZSeTNieC9QTjUreVdxQUxmRWszdlFKZWk5dDd3a1lGQ2Q1clJicm5lb01lN1RnbVljUnoyL1p6dGR6MEU1em5KWFArWGc5dFRmR1lCTytpK09YYk1jREpnbFdZMTMxVGNLdjJzdXRBMzlhTml5aHdrK090Z2hRSHV2b0haQTlXaWpwZXlUWVRpd1M4R0h6dzZPa2oyQlhSTnhZSHZWVXpyYitoVEZWb2F6SFpjSGtsM0k3eHJTOW1FbUNuQVpQUEFiWjVnckw5K2UvUmNZNFpZYzZEUzBvcGV4Nk1RZ05ZR2p3NFRWMjFISEQ4azV0MHpCUm5reTZSTlB4U3dFQ3lIRzA4WnJ0MmdLTTVQV0xvQURza0JhdzArL0hZbldNZWcxN1VEZVJROEsrVHFxQk5Wdz09IHdlbmc1ZUA1ZS12bTJcbiIsInBhdGgiOiIvaG9tZS9saWZ0cnZtdXNlci8uc3NoL2F1dGhvcml6ZWRfa2V5cyJ9XSwicHVibGlzaGVyIjoiIiwicmVzb3VyY2VHcm91cE5hbWUiOiJNQ19ncmEtZGV2LWNvMjExMDAxLXNjdXMtcmdfZ3JhLWRldi1jbzIxMTAwMS1zY3VzLWFrc19zb3V0aGNlbnRyYWx1cyIsInJlc291cmNlSWQiOiIvc3Vic2NyaXB0aW9ucy8zYTdlZGY3ZC0xNDg4LTQwMTctYTkwOC1lNTBkMGExNjQyYTYvcmVzb3VyY2VHcm91cHMvTUNfZ3JhLWRldi1jbzIxMTAwMS1zY3VzLXJnX2dyYS1kZXYtY28yMTEwMDEtc2N1cy1ha3Nfc291dGhjZW50cmFsdXMvcHJvdmlkZXJzL01pY3Jvc29mdC5Db21wdXRlL3ZpcnR1YWxNYWNoaW5lU2NhbGVTZXRzL2Frcy1ncmFkZXZzY3VzLTE0Mzg4NzkzLXZtc3MvdmlydHVhbE1hY2hpbmVzLzIiLCJza3UiOiIiLCJzdWJzY3JpcHRpb25JZCI6IjNhN2VkZjdkLTE0ODgtNDAxNy1hOTA4LWU1MGQwYTE2NDJhNiIsInRhZ3MiOiJhenNlY3BhY2s6bm9ucHJvZDtjcmVhdGlvblNvdXJjZTp2bXNzY2xpZW50LWFrcy1ncmFkZXZzY3VzLTE0Mzg4NzkzLXZtc3M7b3JjaGVzdHJhdG9yOkt1YmVybmV0ZXM6MS4yMS4yO3BsYXRmb3Jtc2V0dGluZ3MuaG9zdF9lbnZpcm9ubWVudC5zZXJ2aWNlLnBsYXRmb3JtX29wdGVkaW5fZm9yX3Jvb3RjZXJ0czp0cnVlO3Bvb2xOYW1lOmdyYWRldnNjdXM7cmVzb3VyY2VOYW1lU3VmZml4OjE0Mzg4NzkzIiwidmVyc2lvbiI6IiIsInZtSWQiOiJlOTQxMzM1Ni00ZWRmLTQzMzktODhkNi1lMTc4NTZiOWFjYmQiLCJ2bVNjYWxlU2V0TmFtZSI6ImFrcy1ncmFkZXZzY3VzLTE0Mzg4NzkzLXZtc3MiLCJ2bVNpemUiOiJTdGFuZGFyZF9ENHNfdjMiLCJ6b25lIjoiMyJ9LCJuZXR3b3JrIjp7ImludGVyZmFjZSI6W3siaXB2NCI6eyJpcEFkZHJlc3MiOlt7InByaXZhdGVJcEFkZHJlc3MiOiIxMC4yNDAuMC42IiwicHVibGljSXBBZGRyZXNzIjoiIn1dLCJzdWJuZXQiOlt7ImFkZHJlc3MiOiIxMC4yNDAuMC4wIiwicHJlZml4IjoiMTYifV19LCJpcHY2Ijp7ImlwQWRkcmVzcyI6W119LCJtYWNBZGRyZXNzIjoiMDAwRDNBNzQ3Rjk2In1dfX0=".FromBase64();
            var parsed = JsonConvert.DeserializeObject<InstanceMetadata>(input);
            Assert.Equal("AzurePublicCloud", parsed.Compute.AzEnvironment);
        }
    }
}
