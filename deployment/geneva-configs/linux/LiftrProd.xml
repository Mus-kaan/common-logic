<MonitoringManagement version="1.0" namespace="LiftrProd" timestamp="2020-07-21T00:00:00Z" eventVersion="21">
  <Accounts>
    <Account moniker="liftrproddiag" isDefault="true"/>
    <Account moniker="liftrprodsecurity" alias="AzSecurityStore"/>
    <Account moniker="liftrprodaudit" alias="AuditStore"/>
  </Accounts>
  <Management defaultRetentionInDays="29" eventVolume="Medium">
    <Identity>
      <IdentityComponent name="Tenant" envariable="TENANT" />
      <IdentityComponent name="Role" envariable="ROLE" />
      <IdentityComponent name="RoleInstance" envariable="ROLEINSTANCE" />
      <IdentityComponent name="GenevaPodName" useComputerName="true" />
      <IdentityComponent name="PartnerName" envariable="GENEVA_PARTNER_NAME" />
      <IdentityComponent name="HostResourceGroup" envariable="GENEVA_HOST_RESOURCE_GROUP" />
      <IdentityComponent name="HostAKS" envariable="GENEVA_HOST_AKS" />
      <IdentityComponent name="HostRegion" envariable="GENEVA_HOST_REGION" />
    </Identity>
    <AgentResourceUsage diskQuotaInMB="8000" />
    <AgentMetrics mdmMonitoringAccount="LiftrProdHot" />
  </Management>
  <Schemas>
    <Schema name="taggedSyslog">
      <Column type="str" name="FacilityAndTag" mdstype="mt:wstr" />
      <Column type="str" name="Facility" mdstype="mt:wstr" />
      <Column type="str" name="Severity" mdstype="mt:int32" />
      <Column type="str-rfc3339" name="EventTime" mdstype="mt:utc" />
      <Column type="str" name="SendingHost" mdstype="mt:wstr" />
      <Column type="str" name="Msg" mdstype="mt:wstr" />
      <Column type="str" name="SyslogTag" mdstype="mt:wstr" />
    </Schema>
    <Schema name="syslog">
      <Column type="str" name="Facility" mdstype="mt:wstr" />
      <Column type="str" name="Severity" mdstype="mt:int32" />
      <Column type="str-rfc3339" name="EventTime" mdstype="mt:utc" />
      <Column type="str" name="SendingHost" mdstype="mt:wstr" />
      <Column type="str" name="Msg" mdstype="mt:wstr" />
    </Schema>
    <Schema name="azsecv1">
      <Column type="str" name="Facility" mdstype="mt:wstr" />
      <Column type="str" name="Severity" mdstype="mt:int32" />
      <Column type="str-rfc3339" name="EventTime" mdstype="mt:utc" />
      <Column type="str" name="SendingHost" mdstype="mt:wstr" />
      <Column type="str" name="Msg" mdstype="mt:wstr" />
    </Schema>
    <Schema name="azsecv2">
      <Column type="str" name="AzSecID" mdstype="mt:wstr" />
      <Column type="str" name="ScanName" mdstype="mt:wstr" />
      <Column type="str-rfc3339" name="EventTime" mdstype="mt:utc" />
      <Column type="str" name="Data" mdstype="mt:wstr" />
      <Column type="str" name="PartCount" mdstype="mt:int32" />
      <Column type="str" name="PartIndex" mdstype="mt:int32" />
    </Schema>
  </Schemas>
  <Sources>
    <Source name="liftr" dynamic_schema="true" />
    <Source name="k8scontainers" dynamic_schema="true" />
    <Source name="nginx" dynamic_schema="true" />
    <Source name="ifxauditlogs" dynamic_schema="true" />
    <Source name="kern" schema="syslog" />
    <Source name="auth" schema="syslog" />
    <Source name="authpriv" schema="syslog" />
    <Source name="cron" schema="syslog" />
    <Source name="user" schema="syslog" />
    <Source name="daemon" schema="syslog" />
    <Source name="syslog" schema="syslog" />
    <Source name="heartbeat" schema="azsecv1" />
    <Source name="baseline" schema="azsecv1" />
    <Source name="software" schema="azsecv1" />
    <Source name="clamav" schema="azsecv1" />
    <Source name="scan_event" schema="azsecv2" />
    <Source name="audit" dynamic_schema="true" />
  </Sources>
  <Events>
    <MdsdEvents>
      <!-- Heartbeat events supported without change.-->
      <HeartBeats>
        <HeartBeat eventName="heartbeat" storeType="CentralBond" duration="PT5M" sampleRateInSeconds="60" />
      </HeartBeats>
      <MdsdEventSource source="liftr">
        <RouteEvent account="liftrproddiag" priority="Normal" storeType="CentralBond" eventName="liftrAksApp" />
      </MdsdEventSource>
      <MdsdEventSource source="k8scontainers">
        <RouteEvent account="liftrproddiag" priority="Normal" storeType="CentralBond" eventName="KubernetesContainers" />
      </MdsdEventSource>
      <MdsdEventSource source="nginx">
        <RouteEvent account="liftrproddiag" priority="Normal" storeType="CentralBond" eventName="NginxContainers" />
      </MdsdEventSource>
      <MdsdEventSource source="ifxauditlogs">
        <RouteEvent account="AuditStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmIfxAudit" />
      </MdsdEventSource>
      <MdsdEventSource source="kern">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSecurity" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="auth">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSecurity" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="authpriv">
        <RouteEvent account="AzSecurityStore" priority="High" storeType="CentralBond" eventName="LinuxAsmSecurity" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="cron">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSyslog" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="user">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSyslog" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="daemon">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSyslog" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="syslog">
        <RouteEvent account="liftrproddiag" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSyslog" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="heartbeat">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmHeartbeat" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="baseline">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmBaseline" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="software">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmSoftware" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="clamav">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmClamav" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="scan_event">
        <RouteEvent account="AzSecurityStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmScanEvent" duration="PT1M" />
      </MdsdEventSource>
      <MdsdEventSource source="audit">
        <RouteEvent account="AuditStore" priority="Normal" storeType="CentralBond" eventName="LinuxAsmAudit" duration="PT1M" />
      </MdsdEventSource>
    </MdsdEvents>
    <DerivedEvents>
      <!-- audit application event -->
      <!-- NOTE: please do not change the event name -->
      <DerivedEvent duration="PT1M" eventName="LinuxAsmIfxAuditApplication" source="ifxauditlogs" storeType="CentralBond" whereToRun="Local">
        <Query><![CDATA[
              where (RegexMatch(log,"^ifxauditappl: .*") != "" && RegexMatch(log,"IFxAuditHeartBeatOperationIFx") == "")
              let EventData = RegexMatch(log,"(^ifxauditappl: (.*))", 2)
              select Tenant,Role,MachineName,RoleInstance,EventData
            ]]></Query>
      </DerivedEvent>
      <!-- audit management event -->
      <!-- NOTE: please do not change the event name -->
      <DerivedEvent duration="PT1M" eventName="LinuxAsmIfxAuditManagement" source="ifxauditlogs" storeType="CentralBond" whereToRun="Local">
        <Query><![CDATA[
              where (RegexMatch(log,"^ifxauditmgmt: .*") != "" && RegexMatch(log,"IFxAuditHeartBeatOperationIFx") == "")
              let EventData = RegexMatch(log,"(^ifxauditmgmt: (.*))", 2)
              select Tenant,Role,MachineName,RoleInstance,EventData
            ]]></Query>
      </DerivedEvent>
      <!-- audit heartbeat event -->
      <!-- NOTE: please do not change the event name -->
      <DerivedEvent duration="PT1M" eventName="LinuxAsmHeartbeat" source="ifxauditlogs" storeType="CentralBond" whereToRun="Local">
        <Query><![CDATA[
              where (RegexMatch(log,"IFxAuditHeartBeatOperationIFx") != "")
              let EventData = RegexMatch(log,"(^ifxauditappl: (.*))", 2)
              select Tenant,Role,MachineName,RoleInstance,EventData
            ]]></Query>
      </DerivedEvent>
      <!-- audit errors -->
      <DerivedEvent duration="PT1M" eventName="LinuxAsmIfxAuditError" source="ifxauditlogs" storeType="CentralBond" whereToRun="Local">
        <Query><![CDATA[
              where (RegexMatch(log,"^ifxauditfail: .*") != "")
              let EventData = RegexMatch(log,"(^ifxauditfail: (.*))", 2)
              select Tenant,Role,MachineName,RoleInstance,EventData
            ]]></Query>
      </DerivedEvent>
    </DerivedEvents>
  </Events>
  <EventStreamingAnnotations>
    <EventStreamingAnnotation name="^KubernetesContainers$">
      <LogAnalytics>
        <Content>LogAnalyticsContent</Content>
      </LogAnalytics>
    </EventStreamingAnnotation>
    <EventStreamingAnnotation name="^liftrAksApp$">
      <LogAnalytics>
        <Content>LogAnalyticsContent</Content>
      </LogAnalytics>
    </EventStreamingAnnotation>
    <EventStreamingAnnotation name="^NginxContainers$">
      <LogAnalytics>
        <Content>LogAnalyticsContent</Content>
      </LogAnalytics>
    </EventStreamingAnnotation>
    <EventStreamingAnnotation name="^LinuxAsmIfxAudit$">
      <LogAnalytics>
        <Content>LogAnalyticsContent</Content>
      </LogAnalytics>
    </EventStreamingAnnotation>
  </EventStreamingAnnotations>
</MonitoringManagement>